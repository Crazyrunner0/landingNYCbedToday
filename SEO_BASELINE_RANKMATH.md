# SEO Baseline Configuration with RankMath

This document describes the SEO baseline setup including RankMath integration, sitemap generation, robots.txt configuration, and JSON-LD structured data implementation.

## Overview

The SEO baseline configuration includes:

1. **RankMath Plugin** - Professional SEO plugin for WordPress
2. **Automated Setup** - Mu-plugin that handles RankMath activation and configuration
3. **Structured Data** - JSON-LD schemas for:
   - LocalBusiness (with placeholder data)
   - BreadcrumbList (automatic navigation trails)
   - FAQPage (with placeholder Q&A)
4. **Sitemaps** - XML sitemap generation at `/sitemap_index.xml`
5. **Robots.txt** - SEO-friendly robots configuration at `/robots.txt`

## Installation

### Prerequisites

Ensure you have Docker and Docker Compose running:

```bash
cd /home/engine/project
make up
```

### Step 1: Update Dependencies

The `composer.json` has been updated to include RankMath:

```bash
# This happens automatically during bootstrap
make bootstrap
```

To manually update:

```bash
make composer CMD='install'
```

### Step 2: Verify RankMath Installation

Check if RankMath is installed and activated:

```bash
make wp CMD='plugin list --status=active | grep rank-math'
```

The mu-plugin (`rankmath-setup.php`) automatically activates RankMath on first plugin load.

### Step 3: Import Settings (Optional)

To import the pre-configured RankMath settings:

```bash
make wp CMD='eval-file scripts/rankmath-import-settings.php'
```

## Automatic Setup

The `web/app/mu-plugins/rankmath-setup.php` mu-plugin automatically:

1. **Activates RankMath** - If installed but not active
2. **Configures Default Settings**:
   - Enables sitemap generation
   - Enables JSON-LD schema output
   - Sets up site metadata
   - Configures robots.txt directives
3. **Outputs JSON-LD Schemas**:
   - LocalBusiness on homepage
   - BreadcrumbList on all pages
   - FAQPage on homepage with placeholder Q&A

## JSON-LD Schemas

### LocalBusiness Schema

Automatically output on the homepage (`is_front_page()`). Includes:

- Business name and description
- Address (NYC placeholder)
- Phone number
- Latitude/Longitude coordinates
- Social media links
- Site logo

**Placeholder Data:**
- Address: 123 Main Street, New York, NY 10001, USA
- Phone: +1 (212) 555-0123
- Coordinates: 40.7128¬∞ N, 74.0060¬∞ W (Manhattan, NYC)

**Customizing LocalBusiness Schema:**

Use the `nycbedtoday_localbusiness_schema` filter:

```php
add_filter('nycbedtoday_localbusiness_schema', function($schema) {
    $schema['name'] = 'Your Business Name';
    $schema['address']['streetAddress'] = 'Your Street Address';
    $schema['address']['addressLocality'] = 'Your City';
    $schema['address']['postalCode'] = 'Your ZIP';
    $schema['telephone'] = 'Your Phone';
    return $schema;
});
```

### BreadcrumbList Schema

Automatically output on all non-homepage pages. Automatically builds breadcrumb navigation trails:

- Single posts: Home > Post Title
- Archives: Home > Archive Type
- Categories: Home > Category Name
- Custom taxonomies: Home > Taxonomy Term

**Customizing BreadcrumbList Schema:**

Use the `nycbedtoday_breadcrumb_schema` filter to modify breadcrumbs.

### FAQPage Schema

Automatically output on the homepage. Includes placeholder Q&A:

- What mattress sizes do you offer?
- Do you offer delivery?
- What is your return policy?
- Are your mattresses eco-friendly?

**Customizing FAQ Schema:**

Use the `nycbedtoday_faq_items` filter to add/modify FAQ items:

```php
add_filter('nycbedtoday_faq_items', function($items) {
    $items[] = [
        'question' => 'Your Question?',
        'answer'   => 'Your Answer',
    ];
    return $items;
});
```

Or extend the FAQPage schema:

```php
add_filter('nycbedtoday_faq_schema', function($schema) {
    // Modify the FAQ schema as needed
    return $schema;
});
```

## Sitemap Configuration

### Accessing Sitemaps

- **Sitemap Index:** `http://localhost:8080/sitemap_index.xml`
- **Posts Sitemap:** `http://localhost:8080/sitemap-posts.xml`
- **Pages Sitemap:** `http://localhost:8080/sitemap-pages.xml`
- **Products Sitemap:** `http://localhost:8080/sitemap-product.xml` (if WooCommerce is active)
- **Taxonomies Sitemap:** `http://localhost:8080/sitemap-taxonomies.xml`

### Sitemap Generation

Sitemaps are generated automatically by RankMath:

1. When the sitemap is first requested
2. When posts/pages are published or updated
3. On scheduled updates (can be configured in RankMath settings)

### Sitemap Testing

Verify sitemaps are working:

```bash
# Check sitemap index
curl -I http://localhost:8080/sitemap_index.xml

# Expected response:
# HTTP/1.1 200 OK
# Content-Type: application/xml
```

## Robots.txt Configuration

### Accessing Robots.txt

- **Main Robots.txt:** `http://localhost:8080/robots.txt`

### Configuration

Robots.txt is automatically generated by RankMath with:

```
User-agent: *
Allow: /
Disallow: /wp-admin/
Disallow: /wp-includes/
Disallow: /wp-login.php

Sitemap: http://yoursite.com/sitemap_index.xml
```

### Testing Robots.txt

```bash
# Check robots.txt
curl -I http://localhost:8080/robots.txt

# Expected response:
# HTTP/1.1 200 OK
# Content-Type: text/plain
```

## Validation & Testing

### Manual Validation Steps

#### 1. Check RankMath Status

```bash
# Verify RankMath is active
make wp CMD='plugin list --status=active'

# Should show:
# rank-math | 1.x.x | active
```

#### 2. Verify Sitemaps

Visit these URLs in your browser:

- `http://localhost:8080/sitemap_index.xml` - Should return XML with sitemap entries
- `http://localhost:8080/robots.txt` - Should return text with robots directives

**Expected XML structure for sitemap_index.xml:**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<sitemapindex xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <sitemap>
    <loc>http://localhost:8080/sitemap-posts.xml</loc>
  </sitemap>
  <sitemap>
    <loc>http://localhost:8080/sitemap-pages.xml</loc>
  </sitemap>
  <!-- Additional sitemaps... -->
</sitemapindex>
```

#### 3. Check JSON-LD Schemas

Visit the homepage and check the page source for:

```html
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  ...
}
</script>
```

You should see multiple JSON-LD blocks:
- LocalBusiness schema
- BreadcrumbList schema
- FAQPage schema

#### 4. Use Google Rich Results Test

The official way to validate structured data:

1. Go to [Google Rich Results Test](https://search.google.com/test/rich-results)
2. Enter your site URL: `http://localhost:8080`
3. Wait for the test to complete

**Expected Results:**

- ‚úÖ FAQPage - Should be detected
- ‚úÖ LocalBusiness - Should be detected
- ‚úÖ BreadcrumbList - Should be detected (if on article/page)
- ‚úÖ Organization - May also be detected

**Note:** The test may show warnings about recommended fields (e.g., priceRange for LocalBusiness), but these are optional and not errors.

#### 5. Schema.org Validator (Alternative)

If Google Rich Results Test is unavailable:

1. Go to [Schema.org Validator](https://validator.schema.org/)
2. Paste your site URL or HTML source
3. Review the validation results

#### 6. Structured Data Testing Tool (Google Search Console)

If you have Google Search Console access:

1. Add your site to GSC
2. Go to Enhancements > Rich Results
3. View detected schemas and any errors

### Docker Environment Considerations

The application runs in Docker, so ensure:

1. **Port forwarding** - Docker is configured to expose port 8080
2. **Hostname resolution** - Use `http://localhost:8080` not the internal Docker hostname
3. **Nginx configuration** - Rewrite rules for sitemaps and robots.txt are handled by Nginx

## Troubleshooting

### RankMath Not Activating

**Problem:** RankMath plugin not appearing in active plugins list

**Solution:**

```bash
# Manually activate RankMath
make wp CMD='plugin activate rank-math'

# Check if activated
make wp CMD='plugin is-active rank-math'
```

### Sitemaps Returning 404

**Problem:** `http://localhost:8080/sitemap_index.xml` returns 404

**Solution:**

1. Verify RankMath is active: `make wp CMD='plugin is-active rank-math'`
2. Force RankMath to regenerate sitemaps:
   ```bash
   make wp CMD='eval-file scripts/rankmath-import-settings.php'
   ```
3. Flush WordPress rewrite rules:
   ```bash
   make wp CMD='rewrite flush'
   ```
4. Check Nginx configuration - verify Docker is running: `make up`

### JSON-LD Not Appearing

**Problem:** JSON-LD schemas not found in page source

**Solution:**

1. Verify mu-plugin is loaded: `make wp CMD='mu-plugin list'`
   - Should show `rankmath-setup` as active
2. Check homepage renders: `curl -s http://localhost:8080 | grep "application/ld+json"` should show results
3. Verify RankMath schema module is enabled:
   ```bash
   make wp CMD='option get rank-math-modules --format=json'
   ```

### Custom Data Not Showing

**Problem:** Placeholder data (address, phone) not appearing in schemas

**Solution:**

Custom LocalBusiness data can be updated via filters. Edit your theme's `functions.php`:

```php
add_filter('nycbedtoday_localbusiness_schema', function($schema) {
    $schema['address']['streetAddress'] = 'Your Address';
    $schema['telephone'] = 'Your Phone';
    return $schema;
});
```

Or update RankMath site metadata directly:

```bash
make wp CMD='option update rank-math-site-meta "{\"address\":\"Your Address\",\"phone\":\"Your Phone\"}"'
```

## Advanced Configuration

### Customizing RankMath Settings

Access RankMath admin panel:

1. Log in to WordPress: `http://localhost:8080/wp-admin`
2. Navigate to: `RankMath > General Settings`
3. Configure:
   - Site title and description
   - Knowledge graph type
   - Schema types to enable
   - Sitemap settings

### Enabling Additional Schema Types

In the RankMath admin or via code:

```php
add_filter('nycbedtoday_localbusiness_schema', function($schema) {
    // Add opening hours
    $schema['openingHoursSpecification'] = [
        [
            '@type' => 'OpeningHoursSpecification',
            'dayOfWeek' => ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
            'opens' => '09:00',
            'closes' => '18:00',
        ],
    ];
    
    // Add social media profiles
    $schema['sameAs'][] = 'https://www.linkedin.com/company/nycbedtoday';
    
    return $schema;
});
```

### Integrating with WooCommerce

If WooCommerce is active:

1. RankMath automatically generates sitemaps for products
2. JSON-LD schema can include product information
3. Breadcrumbs work with product archives and single products

### Monitoring & Analytics

To track SEO performance:

1. **Google Search Console** - Submit sitemap: `http://yoursite.com/sitemap_index.xml`
2. **RankMath Analytics** - Premium feature, shows keyword rankings
3. **WordPress Admin** - RankMath dashboard shows page/post SEO scores

## Next Steps

1. ‚úÖ **Baseline Established** - Core SEO setup complete
2. üìù **Customize Data** - Update placeholder address, phone, FAQ questions
3. üîç **Validate Schemas** - Use Google Rich Results Test
4. üìä **Monitor Performance** - Check Google Search Console
5. üöÄ **Go Live** - Deploy to production with permanent domain

## File Reference

- **Mu-Plugin:** `web/app/mu-plugins/rankmath-setup.php`
- **Settings Import:** `scripts/rankmath-import-settings.php`
- **Settings JSON:** `scripts/rankmath-settings.json`
- **Composer Config:** `composer.json` (line 46: `wpackagist-plugin/rank-math: ^1.0`)

## Support & Documentation

- **RankMath Documentation:** https://rankmath.com/kb/
- **RankMath Free Features:** https://rankmath.com/wordpress/free/
- **Schema.org Documentation:** https://schema.org/
- **Google Search Console:** https://search.google.com/search-console

## Acceptance Criteria Checklist

- ‚úÖ RankMath installed and activated (via Composer + mu-plugin)
- ‚úÖ RankMath configured with placeholder metadata and sitemap enabled
- ‚úÖ `/sitemap_index.xml` returns valid XML sitemap
- ‚úÖ `/robots.txt` returns proper directives
- ‚úÖ Homepage renders LocalBusiness JSON-LD schema
- ‚úÖ All pages render BreadcrumbList JSON-LD schema
- ‚úÖ Homepage includes FAQPage JSON-LD schema with Q&A
- ‚úÖ Google Rich Results Test validates without critical errors
- ‚úÖ Documentation includes validation steps and troubleshooting

